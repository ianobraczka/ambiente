<div class="history-container">
  ←
  <%= link_to @subsystem.system.area.enterprise.program.name, @subsystem.system.area.enterprise.program %>
  ←
  <%= link_to @subsystem.system.area.enterprise.name, @subsystem.system.area.enterprise %>
  ←
  <%= link_to @subsystem.system.area.name, @subsystem.system.area %>
  ←
  <%= link_to @subsystem.system.name, @subsystem.system %>
</div>

<div id="edit-and-delete-section-buttons-container">

  <div class="edit-section-button"><%= button_to 'Editar', edit_subsystem_path(@subsystem), :class => "btn" %></div>
  <div class="delete-section-button"><%= button_to "Deletar subsistema", @subsystem, method: :delete, data: { confirm: 'Tem certeza que quer deletar esse subsistema?' }, :class => "btn btn-danger" %></div>

</div>

<h1 class="area-title"><%= @subsystem.name %></h1>

<div class="list-item section-details">

  <br>

  <div class="content"><strong><span class="percentage-number"><%=@subsystem.completed%>%</span></strong> completo</div>
  <div class="content"><b>Investimento:</b> <%= number_to_currency(@subsystem.price, :unit => "R$") %></div>
  <% if !@subsystem.has_desagregation? %>
    <div class="content"><b>Qtd planejada:</b><br></div>
    <div class="content"><%= @subsystem.total_quantity %> <%=@subsystem.unity%></div>
  <% end %>

  <hr>

  <div class="content"><b>HH:</b> <%= @subsystem.hh %></div>
  <div class="content"><b>Valor:</b> <%= number_to_currency(@subsystem.value, :unit => "R$") %></div>
  <div class="content"><b>Porcentagem:</b> <%= @subsystem.percentage %>%</div>

  <hr>

  <%= form_for(@subsystem) do |f| %>
  <% if @subsystem.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@subsystem.errors.count, "error") %> prohibited this product from being saved:</h2>

      <ul>
      <% @subsystem.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

    <div class="content"><%= f.label "Escolha o ponderador" %></div>
    <div class="content"><%= f.select :weight, options_for_select([["Valor", 1], ["HH", 2], ["Porcentagem", 3]], @subsystem.weight) %></div>
   <center><div class="content"> <%= f.submit "Ponderar", :class => "btn btn-success" %></div></center>
   <br>

</div>

<% end %>

<%= button_to "Gerar relatório", subsystem_report_path(@subsystem), :class => "btn", :method => "get" %>

<% if !@subsystem.has_desagregation? && @subsystem.price != 0 then %>

  <% if @subsystem.plannings.empty? then %>
    
    <div class="alert alert-error">
    <button type="button" class="close" data-dismiss="alert">&times;</button>
    <center>
    <strong>Esse sistema é o nível mais desagregado e ainda não possui nenhum período cadastrado </strong>
    </div>
    </center>
    <br>
    <center><%= button_to "Cadastrar planejamentos", new_subsystem_planning_path(@subsystem), :method => "get", :class => "btn btn-success" %></center>
    <br>
  <%end%>
  <% if !@subsystem.plannings.empty? then %>

    <% if @subsystem.current_planning.days_left != -1 then %>
    <div class="alert alert-error">
    <button type="button" class="close" data-dismiss="alert">&times;</button>
     <strong> O <%= link_to "atual período", @subsystem.current_planning %> é o <%= @subsystem.plannings.count %>º e <b><span class="small_font">faltam <%= @subsystem.current_planning.days_left %> dias</b></span> para o término dele. </strong>
    </div>
    <%end%>
    <% if @subsystem.current_planning.days_left == -1 then %>
      <b><font color="red"> O <%= @subsystem.plannings.count %>o período terminou, crie um novo período: </font></b>
      <Br>
      <br>
      <%= button_to "Novo período", new_subsystem_planning_path(@subsystem), :method => "get" %>
    <% end %>
    <center>
    <br>
    <span class="very_small_font">
    <b>Quantidade planejada no período:</b> <%= @subsystem.plannings.last.planned_quantity %> <%=@subsystem.unity%> <br>
    <b>Quantidade realizada no período:</b> <%= @subsystem.plannings.last.quantity %> <%=@subsystem.unity%> (<b><font color = "red"><%= @subsystem.plannings.last.quantity_percentage %>%</font></b>)
    <br>
    <br>
    <b>Quantidade realizada até o período:</b>
    <%= @subsystem.total_quantity %> <%=@subsystem.unity%> (<b><font color = "red"><%=@subsystem.quantity_percentage%>%</font></b>)
    <br>
    <b>Quantidade planejada até o período:</b>
    <%= @subsystem.planned_quantity %> <%=@subsystem.unity%>
    </center>
    </span>
    <br>
    <br>
  <% end %>
<%end%>

<hr>

<div class="right-aligned-create-button-container">
  <%= button_to "Criar subsubsistema", new_subsystem_subsubsystem_path(@subsystem), :method => "get", class: "btn btn-success" %>
</div>

<h2 class="area-subtitle">SUBSUBSISTEMAS</h2>

<% if !@subsystem.has_desagregation? && @subsystem.price == 0 then %>
  <div class="alert alert-error">
    <button type="button" class="close" data-dismiss="alert">&times;</button>
    <center>
      <strong>Esse subsistema não possui nenhum subsubsistema.<br></strong></font>
    </center>
    </button>
  </div>
<%end%>

<% if @subsystem.has_desagregation? then %>
  <div class="row">
  <% @subsystem.subsubsystems.each do |subsubsystem| %>
    <div class="span3 list-item">

      <div class="name"><%= link_to subsubsystem.name, subsubsystem %></div>
      <div class="content"><span class="percentage-number"><b><%= subsubsystem.completed %>%</b></span> completo</div>
      <div class="content"><b>Investimento: </b><%= number_to_currency(subsubsystem.price, :unit => "R$") %></div>
      <hr>
      <div class="content"><b>Quant. estimada:</b> <%= subsubsystem.planned_quantity %> <%= subsubsystem.unity %></div>
      <div class="content"><b>Quant. realizada:</b> <%= subsubsystem.real_quantity %> <%= subsubsystem.unity %></div>

      <hr>

      <div class="content"><b>HH:</b> <%= subsubsystem.hh %></div>
      <div class="content"><b>Porcentagem:</b> <%= subsubsystem.percentage %>%</div>
      <div class="content"><b>Valor:</b> <%= number_to_currency(subsubsystem.value, :unit => "R$") %></div>
      <br>
    </div>
  <%end%>
  </div>
<%end%>
<br>