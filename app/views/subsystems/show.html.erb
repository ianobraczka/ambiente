<div class="history-container">
  ←
  <%= link_to @subsystem.system.area.enterprise.program.name, @subsystem.system.area.enterprise.program %>
  ←
  <%= link_to @subsystem.system.area.enterprise.name, @subsystem.system.area.enterprise %>
  ←
  <%= link_to @subsystem.system.area.name, @subsystem.system.area %>
  ←
  <%= link_to @subsystem.system.name, @subsystem.system %>
</div>

<div id="edit-and-delete-section-buttons-container">

  <div class="edit-section-button"><%= button_to 'Editar', edit_subsystem_path(@subsystem), :class => "btn" %></div>
  <div class="delete-section-button"><%= button_to "Deletar subsistema", @subsystem, method: :delete, data: { confirm: 'Tem certeza que quer deletar esse subsistema?' }, :class => "btn btn-danger" %></div>

</div>

<h1 class="area-title"><%= @subsystem.name %></h1>

<div class="list-item section-details">

  <br>

  <div class="content"><strong><span class="percentage-number"><%=@subsystem.completed%>%</span></strong> completo</div>
  <div class="content"><b>Investimento:</b> <%= number_to_currency(@subsystem.price, :unit => "R$") %></div>
  <% if !@subsystem.has_desagregation? %>
    <div class="content"><b>Qtd planejada:</b><br></div>
    <div class="content"><%= @subsystem.total_quantity %> <%=@subsystem.unity%></div>
  <% end %>

  <hr>

  <div class="content"><b>HH:</b> <%= @subsystem.hh %></div>
  <div class="content"><b>Valor:</b> <%= number_to_currency(@subsystem.value, :unit => "R$") %></div>
  <div class="content"><b>Porcentagem:</b> <%= @subsystem.percentage %>%</div>

  <hr>

  <%= form_for(@subsystem) do |f| %>
  <% if @subsystem.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@subsystem.errors.count, "error") %> prohibited this product from being saved:</h2>

      <ul>
      <% @subsystem.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

    <div class="content"><%= f.label "Escolha o ponderador" %></div>
    <div class="content"><%= f.select :weight, options_for_select([["Valor", 1], ["HH", 2], ["Porcentagem", 3]], @subsystem.weight) %></div>
   <center><div class="content"> <%= f.submit "Ponderar", :class => "btn btn-success" %></div></center>
   <br>

</div>

<% end %>

<%= button_to "Gerar relatório", subsystem_report_path(@subsystem), :class => "btn", :method => "get" %>

<% if !@system.has_desagregation? && @system.price == 0 then %>
  <br>
  <div class="alert alert-error">
  <button type="button" class="close" data-dismiss="alert">&times;</button>
  <strong><center>Esse subsistema não possui nenhum subsubsistema cadastrado. Para prosseguir, voce deve escolher se ele possui subsubsistemas ou se é o nível mais desagregado:</strong></center></div>
  <br><center>
  <div id="choose-system-type-buttons">
    <div class = "edit-section-button">
    <%= button_to "É o nível mais desagregado", edit_subsystem_path(@subsystem), :method => "get", :class => "btn btn-info"%>
    </div>
    <div class = "delete-section-button">
    <%= button_to "Criar subsubsistema", new_subsystem_subsubsystem_path(@subsystem), :method => "get", :class => "btn btn-success" %>
    </div>
    </center>
  </div>
<%end%>

<hr>

<% if !@subsystem.has_desagregation? && @subsystem.price != 0 then %>
  <% if !@subsystem.plannings.empty? %>
    <hr>
    <span class="medium_font"> Planejamento:<br><br></span>
    <div class="row">
  
    <% @subsystem.current_planning.periods.each do |period| %>
      <div class="span4 list-item">
      <div class="name"> <%= period.number %>o período </div>
      <div class="content"> Quant. planejada no período: <%= period.planned_quantity %> <%= @subsystem.unity %></div>
      <% if period.quantity != nil %>
        <div class="content"> Quant. realizada no período: <%= period.real_quantity %> <%= @subsystem.unity %></div>
      <%end%>
      <% if @subsystem.current_period.quantity == nil && @subsystem.current_period == period %>
          <%= form_for(@subsystem.current_period) do |f| %>
            <% if @subsystem.current_period.errors.any? %>
              <div id="error_explanation">
              <h2><%= pluralize(@subsystem.current_period.errors.count, "error") %> prohibited this product from being saved:</h2>
              <ul>
              <% @subsystem.current_period.errors.full_messages.each do |msg| %>
                <li><%= msg %></li>
              <% end %>
              </ul>
              </div>
            <% end %>
            <hr>
            <div class = "content">
            <center><span class = "very_small_font"> Quant. realizada:</span><br><br>
            <%= f.number_field :quantity %>
            <br><%= f.submit "Entrar", :class => "btn btn-success" %></center>
            </div>
          <% end %>
      <%end%>
      </div>
    <%end%>
    </div>
  </center>
<% else %>
  <br>
  <div class="alert alert-error">
    <button type="button" class="close" data-dismiss="alert">&times;</button>
    <center>
    <strong>Esse sistema ainda não possui planejamento </strong>
    </div>
    </center>
    <br>
    <center><%= button_to "Cadastrar planejamento", new_subsystem_planning_path(@subsystem), :method => "get", :class => "btn btn-success" %></center>
    <br>
<%end%>
<%end %>

<% if @subsystem.has_desagregation? then %>

  <h2 class="area-subtitle">SUBSUBSISTEMAS</h2>


  <div class="row">
  <% @subsystem.subsubsystems.each do |subsubsystem| %>
    <div class="span3 list-item">

      <div class="name"><%= link_to subsubsystem.name, subsubsystem %></div>
      <div class="content"><span class="percentage-number"><b><%= subsubsystem.completed %>%</b></span> completo</div>
      <div class="content"><b>Investimento: </b><%= number_to_currency(subsubsystem.price, :unit => "R$") %></div>
      <hr>
      <div class="content"><b>Quant. estimada:</b> <%= subsubsystem.planned_quantity %> <%= subsubsystem.unity %></div>
      <div class="content"><b>Quant. realizada:</b> <%= subsubsystem.real_quantity %> <%= subsubsystem.unity %></div>

      <hr>

      <div class="content"><b>HH:</b> <%= subsubsystem.hh %></div>
      <div class="content"><b>Porcentagem:</b> <%= subsubsystem.percentage %>%</div>
      <div class="content"><b>Valor:</b> <%= number_to_currency(subsubsystem.value, :unit => "R$") %></div>
      <br>
    </div>
  <%end%>
  </div>
<%end%>
<br>